<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Server Test</title>
  </head>
  <body>
    <div id="main">
      <form id="postForm">
        Category:<br /><span id="category"></span><br />
        UserId:<br /><span id="userId"></span><br />
        <label for="title">Title:</label><br />
        <input type="text" id="title" name="title" required /><br />

        <label for="content">Content:</label><br />
        <textarea id="content" name="content" rows="10" required></textarea
        ><br />

        <label for="tag">Tags:</label><br />
        <input type="text" id="tag1" name="tag1" /><br />
        <input type="text" id="tag2" name="tag2" /><br />
        <input type="text" id="tag3" name="tag3" /><br />
        <input type="text" id="tag4" name="tag4" /><br />
        <input type="text" id="tag5" name="tag5" /><br />
        <button type="button" onclick="editForm()">수정하기</button>
      </form>
    </div>

    <script>
      const url = new URL(window.location.href);
      const postId = url.pathname.split("/")[4];

      document.addEventListener("DOMContentLoaded", () => {
        fetch(`/api/post/edit/data/${postId}`)
          .then((response) => response.json())
          .then((data) => {
            console.log(data);
            document.getElementById("category").innerHTML = data[0].category;
            document.getElementById("userId").innerHTML = data[0].userId;
            document.getElementById("title").value = data[0].title;
            document.getElementById("content").value = data[0].content;
            for (i = 0; i < data.length; i++) {
              const tagId = `tag${i + 1}`;
              document.getElementById(tagId).value = data[i].tag;
            }
          })
          .catch((error) => {
            console.error("Error fetching data:", error);
          });
      });

      function editForm() {
        const title = document.getElementById("title").value;
        const content = document.getElementById("content").value;
        const tags = {
          tag1: document.getElementById("tag1").value,
          tag2: document.getElementById("tag2").value,
          tag3: document.getElementById("tag3").value,
          tag4: document.getElementById("tag4").value,
          tag5: document.getElementById("tag5").value,
        };

        fetch(`/api/post/${postId}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            title,
            content,
            tags,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            console.log("Post updated successfully:", data);
          })
          .catch((error) => {
            console.error("Error updating post:", error);
          });

        fetch(`/api/tag/${postId}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ postId, tags }),
        })
          .then((response) => response.json())
          .then((data) => {
            console.log("Post updated successfully:", data);
          })
          .catch((error) => {
            console.error("Error updating post:", error);
          });
      }
    </script>
  </body>
</html>
